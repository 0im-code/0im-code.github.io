<!DOCTYPE html>
<html>
<head>
  <title>Advanced Goal Tracker with People</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table, td, th { border: 1px solid black; border-collapse: collapse; }
    th, td { padding: 5px; text-align: center; }
    .done { background-color: #c8f7c5; }
    .notdone { background-color: #f7c5c5; }
    select, input, button { margin: 5px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Goal Tracker</h1>

  <label for="viewMode">View by:</label>
  <select id="viewMode" onchange="renderTable()">
    <option value="day">Day</option>
    <option value="week">Week</option>
    <option value="month" selected>Month</option>
    <option value="year">Year</option>
  </select>

  <label for="monthSelect">Choose Month:</label>
  <select id="monthSelect" onchange="renderTable()">
    <option value="01">January</option>
    <option value="02">February</option>
    <option value="03">March</option>
    <option value="04">April</option>
    <option value="05">May</option>
    <option value="06">June</option>
    <option value="07">July</option>
    <option value="08">August</option>
    <option value="09">September</option>
    <option value="10">October</option>
    <option value="11">November</option>
    <option value="12">December</option>
  </select>

  <label for="personFilter">Filter by Person:</label>
  <select id="personFilter" onchange="renderTable()">
    <option value="">All</option>
  </select>

  <br>
  <input type="text" id="newGoalInput" placeholder="Enter a goal">
  <input type="text" id="personInput" placeholder="Person">
  <button onclick="addGoal()">Add Goal</button>

  <div id="trackerTable"></div>
  <canvas id="summaryChart" height="150"></canvas>

  <script>
    let goals = JSON.parse(localStorage.getItem("goals") || "[]");
    let progress = JSON.parse(localStorage.getItem("progress") || "{}");
    let chart = null;

    function daysInMonth(month) {
      return new Date(2025, parseInt(month), 0).getDate();
    }

    function saveData() {
      localStorage.setItem("goals", JSON.stringify(goals));
      localStorage.setItem("progress", JSON.stringify(progress));
    }

    function addGoal() {
      const input = document.getElementById("newGoalInput");
      const person = document.getElementById("personInput").value.trim();
      const text = input.value.trim();
      if (text === "" || person === "") return;
      goals.push({ name: text, person });
      input.value = "";
      document.getElementById("personInput").value = "";
      saveData();
      renderTable();
    }

    function deleteGoal(index) {
      const month = document.getElementById("monthSelect").value;
      goals.splice(index, 1);
      for (let key in progress) {
        if (progress[key][index]) {
          progress[key].splice(index, 1);
        }
      }
      saveData();
      renderTable();
    }

    function toggleStatus(goalIndex, day) {
      const month = document.getElementById("monthSelect").value;
      if (!progress[month]) progress[month] = [];
      if (!progress[month][goalIndex]) progress[month][goalIndex] = [];

      const current = progress[month][goalIndex][day];
      progress[month][goalIndex][day] = current === "‚úî" ? "‚úò" : current === "‚úò" ? "" : "‚úî";

      saveData();
      renderTable();
    }

    function renderTable() {
      const month = document.getElementById("monthSelect").value;
      const viewPerson = document.getElementById("personFilter").value;
      const days = daysInMonth(month);
      const tableDiv = document.getElementById("trackerTable");

      const uniquePeople = [...new Set(goals.map(g => g.person))];
      const filter = document.getElementById("personFilter");
      filter.innerHTML = '<option value="">All</option>' + uniquePeople.map(p => `<option value="${p}">${p}</option>`).join('');
      filter.value = viewPerson;

      let html = "<table><thead><tr><th>Goal</th>";
      for (let d = 1; d <= days; d++) html += `<th>${d}</th>`;
      html += "<th>Delete</th></tr></thead><tbody>";

      goals.forEach((goal, i) => {
        if (viewPerson && goal.person !== viewPerson) return;
        html += `<tr><td>${goal.name} <span style='font-size:smaller;'>(${goal.person})</span></td>`;
        for (let d = 1; d <= days; d++) {
          const status = (progress[month] && progress[month][i] && progress[month][i][d]) || "";
          const className = status === "‚úî" ? "done" : status === "‚úò" ? "notdone" : "";
          html += `<td class="${className}" onclick="toggleStatus(${i}, ${d})">${status}</td>`;
        }
        html += `<td><button onclick="deleteGoal(${i})">üóëÔ∏è</button></td></tr>`;
      });

      html += "</tbody></table>";
      tableDiv.innerHTML = html;

      renderChart();
    }

    function renderChart() {
      const view = document.getElementById("viewMode").value;
      const month = document.getElementById("monthSelect").value;
      const viewPerson = document.getElementById("personFilter").value;
      const days = daysInMonth(month);

      const filteredGoals = goals.map((g, i) => ({...g, index: i})).filter(g => !viewPerson || g.person === viewPerson);

      const data = filteredGoals.map(({ index }) => {
        let count = 0;
        let total = 0;

        if (!progress[month] || !progress[month][index]) return 0;

        if (view === "day") {
          const today = new Date().getDate();
          const status = progress[month][index][today];
          count = status === "‚úî" ? 1 : 0;
          total = 1;
        } else if (view === "week") {
          const today = new Date().getDate();
          const start = Math.max(1, today - 6);
          for (let d = start; d <= today; d++) {
            const status = progress[month][index][d];
            if (status === "‚úî") count++;
            total++;
          }
        } else if (view === "month") {
          for (let d = 1; d <= days; d++) {
            const status = progress[month][index][d];
            if (status === "‚úî") count++;
            total++;
          }
        } else if (view === "year") {
          for (let m = 1; m <= 12; m++) {
            const mStr = m.toString().padStart(2, '0');
            if (!progress[mStr] || !progress[mStr][index]) continue;
            const monthData = progress[mStr][index];
            for (let d in monthData) {
              if (monthData[d] === "‚úî") count++;
              total++;
            }
          }
        }

        return total ? Math.round((count / total) * 100) : 0;
      });

      const ctx = document.getElementById("summaryChart").getContext("2d");

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: filteredGoals.map(g => g.name + " (" + g.person + ")"),
          datasets: [{
            label: "% Complete",
            data: data,
            backgroundColor: "lightgreen"
          }]
        },
        options: {
          indexAxis: 'y',
          scales: {
            x: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: value => value + "%"
              }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => ctx.parsed.x + "% complete"
              }
            }
          }
        }
      });
    }

    renderTable();
  </script>
</body>
</html>
